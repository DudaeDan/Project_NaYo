<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Board View</title>
    <style>
        .like-icon {
            width: 32px;
            height: 32px;
            cursor: pointer;
        }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        function toggleLike(boardId) {
            const likeIcon = $('#like-icon');
            const likeCount = $('#like-count');
            $.ajax({
                url: `/board/like/${boardId}`,
                type: 'POST',
                contentType: 'application/json',
                success: function(status) {
                    if (status === 'liked') {
                        likeIcon.attr('src', '/Images/border/like.png');
                        likeCount.text(parseInt(likeCount.text()) + 1);
                    } else if (status === 'unliked') {
                        likeIcon.attr('src', '/Images/border/empty_like.png');
                        likeCount.text(parseInt(likeCount.text()) - 1);
                    } else if (status === 'notLoggedIn') {
                        alert("로그인 후 이용 가능합니다.");
                    }
                },
                error: function(error) {
                    console.error('Error:', error);
                }
            });
        }

        function alertLogin() {
            alert("로그인 후 이용 가능합니다.");
        }
    </script>
</head>
<body>
    <h1 th:text="${board.boardTitle}">Board Title</h1>
    <p>Ingredients: <span th:text="${board.boardIngredient}"></span></p>
    <p>Date: <span th:text="${board.boardDate}"></span></p>
    <p>Author: <span th:text="${board.user != null ? board.user.userNickname : 'Unknown User'}"></span></p>
    <p>Views: <span th:text="${board.boardHit}"></span></p>
    <p>Likes: <span id="like-count" th:text="${board.boardLike}"></span></p>
    <img th:src="@{'/Images/border/main/' + ${board.mainImg}}" alt="Main Image">

    <h2>Steps</h2>
    <div th:each="step : ${steps}">
        <img th:src="@{'/Images/border/step/' + ${step.stepImage}}" alt="Step Image">
        <p th:text="${step.stepDescription}"></p>
    </div>

    <div>
        <img id="like-icon"
             th:src="${isLiked} ? '/Images/border/like.png' : '/Images/border/empty_like.png'"
             onmouseover="this.src='/Images/border/like_hover.png'"
             th:onmouseout="${isLiked} ? 'this.src=\'/Images/border/like.png\'' : 'this.src=\'/Images/border/empty_like.png\''"
             th:onclick="${session.user != null} ? 'toggleLike(' + ${board.boardNumber} + ')' : 'alertLogin()'"
             class="like-icon">
    </div>
</body>
</html>